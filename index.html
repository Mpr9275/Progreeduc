<!DOCTYPE html>  
<html lang="fr">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">  
    <meta name="apple-mobile-web-app-capable" content="yes">  
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">  
    <link rel="apple-touch-icon" href="https://i.postimg.cc/GpY54myT/POULP-icone.png">
    <meta name="apple-mobile-web-app-title" content="pOULP">
    <meta name="theme-color" content="#2563eb">
    <title>G√©n√©rateur de Programmes de R√©√©ducation</title>  
    <style>  
        * { box-sizing: border-box; margin: 0; padding: 0; }  
          
        body {  
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;  
            background: #f3f4f6;  
            line-height: 1.6;  
        }  
          
        .sr-only {  
            position: absolute;  
            width: 1px;  
            height: 1px;  
            padding: 0;  
            margin: -1px;  
            overflow: hidden;  
            clip: rect(0, 0, 0, 0);  
            white-space: nowrap;  
            border-width: 0;  
        }  
          
        header {  
            background: #2563eb;  
            color: white;  
            padding: 1rem;  
            position: sticky;  
            top: 0;  
            z-index: 100;  
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);  
        }  
          
        .header-content {  
            display: flex;  
            align-items: center;  
            justify-content: space-between;
            gap: 0.75rem;  
            margin-bottom: 0.75rem;  
        }  
          
        .header-logo-left {  
            width: 80px;  
            height: 50px;  
            object-fit: contain;
            flex-shrink: 0;
        }  

        .header-logo-right {  
            width: 50px;  
            height: 50px;  
            object-fit: contain;
            flex-shrink: 0;
        }

        .header-text {
            flex: 1;
            text-align: center;
        }
          
        .header-text h1 {  
            font-size: 1.125rem;  
            margin-bottom: 0.125rem;  
        }  
          
        .header-text p {  
            font-size: 0.75rem;  
            opacity: 0.9;  
        }  
          
        .nav-buttons {  
            display: flex;  
            gap: 0.5rem;  
        }  
          
        .nav-buttons button {  
            flex: 1;  
            background: white;  
            color: #2563eb;  
            border: none;  
            padding: 0.5rem;  
            border-radius: 0.375rem;  
            font-weight: 600;  
            font-size: 0.875rem;  
        }  
          
        .container {  
            padding: 1rem;  
            max-width: 1200px;  
            margin: 0 auto;  
        }  
          
        .section {  
            background: white;  
            border-radius: 0.5rem;  
            padding: 1rem;  
            margin-bottom: 1rem;  
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);  
        }  
          
        .section h2 {  
            font-size: 1.25rem;  
            margin-bottom: 1rem;  
            color: #1f2937;  
        }  
          
        .filter-group {  
            margin-bottom: 1rem;  
        }  
          
        .filter-group label {  
            display: block;  
            font-weight: 600;  
            margin-bottom: 0.5rem;  
            color: #374151;  
        }

        .filter-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: #1f2937;
        }

        .filter-description {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
            font-style: italic;
        }

        .required-badge {
            font-size: 0.75rem;
            font-weight: 600;
            color: #dc2626;
            margin-left: 0.25rem;
        }

        .optional-badge {
            font-size: 0.75rem;
            font-weight: 400;
            color: #6b7280;
            margin-left: 0.25rem;
            font-style: italic;
        }

        .filter-alert {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            color: #92400e;
            font-weight: 500;
        }

        .filter-alert.hidden {
            display: none;
        }  
          
        input[type="text"], input[type="search"], textarea, select {  
            width: 100%;  
            padding: 0.75rem;  
            border: 1px solid #d1d5db;  
            border-radius: 0.375rem;  
            font-size: 1rem;  
        }  
          
        .checkbox-group {  
            display: grid;  
            grid-template-columns: 1fr;  
            gap: 0.5rem;  
        }  
          
        .checkbox-label {  
            display: flex;  
            align-items: center;  
            padding: 0.5rem;  
            background: #f9fafb;  
            border-radius: 0.375rem;  
        }  
          
        .checkbox-label input {  
            margin-right: 0.5rem;  
            width: 1.25rem;  
            height: 1.25rem;  
        }  
          
        .radio-group {  
            display: flex;  
            gap: 1rem;  
            margin: 0.5rem 0;  
        }  
          
        .radio-label {  
            display: flex;  
            align-items: center;  
        }  
          
        .radio-label input {  
            margin-right: 0.5rem;  
        }  
          
        .collapsible-section {  
            border: 1px solid #e5e7eb;  
            border-radius: 0.375rem;  
            margin-bottom: 1rem;  
        }  
          
        .collapsible-header {  
            display: flex;  
            justify-content: space-between;  
            align-items: center;  
            padding: 0.75rem;  
            background: #f9fafb;  
            cursor: pointer;  
            font-weight: 600;  
            border-radius: 0.375rem;  
        }  
          
        .collapsible-header:active {  
            background: #f3f4f6;  
        }  
          
        .collapsible-content {  
            padding: 0.75rem;  
            display: none;  
        }  
          
        .collapsible-content.open {  
            display: block;  
        }  
          
        .chevron {  
            transition: transform 0.2s;  
        }  
          
        .chevron.open {  
            transform: rotate(180deg);  
        }  
          
        button {  
            cursor: pointer;  
            font-size: 1rem;  
            transition: all 0.2s;  
        }  
          
        .btn-primary {  
            background: #2563eb;  
            color: white;  
            border: none;  
            padding: 0.75rem 1.5rem;  
            border-radius: 0.375rem;  
            font-weight: 600;  
            width: 100%;  
        }  
          
        .btn-primary:active {  
            background: #1d4ed8;  
        }  
          
        .btn-secondary {  
            background: #6b7280;  
            color: white;  
            border: none;  
            padding: 0.5rem 1rem;  
            border-radius: 0.375rem;  
            font-weight: 600;  
        }  
          
        .btn-success {  
            background: #059669;  
            color: white;  
            border: none;  
            padding: 0.75rem 1.5rem;  
            border-radius: 0.375rem;  
            font-weight: 600;  
            width: 100%;  
        }  
          
        .btn-danger {  
            background: #dc2626;  
            color: white;  
            border: none;  
            padding: 0.5rem 1rem;  
            border-radius: 0.375rem;  
            font-weight: 600;  
        }  
          
        .btn-small {  
            padding: 0.5rem 0.75rem;  
            font-size: 0.875rem;  
        }  
          
        .badge {  
            display: inline-block;  
            padding: 0.25rem 0.5rem;  
            border-radius: 0.25rem;  
            font-size: 0.75rem;  
            font-weight: 600;  
            margin-right: 0.25rem;  
            margin-bottom: 0.25rem;  
        }  
          
        .badge-blue {  
            background: #dbeafe;  
            color: #1e40af;  
        }  
          
        .badge-green {  
            background: #d1fae5;  
            color: #065f46;  
        }  
          
        .badge-purple {  
            background: #e9d5ff;  
            color: #6b21a8;  
        }  
          
        .exercise-card {  
            background: white;  
            border: 1px solid #e5e7eb;  
            border-radius: 0.5rem;  
            padding: 1rem;  
            margin-bottom: 1rem;  
        }  
          
        .exercise-card h3 {  
            font-size: 1.125rem;  
            margin-bottom: 0.5rem;  
            color: #1f2937;  
        }  
          
        .exercise-card p {  
            color: #6b7280;  
            margin-bottom: 0.75rem;  
        }  
          
        .exercise-card img {  
            width: 100%;  
            max-width: 300px;  
            border-radius: 0.375rem;  
            margin: 0.5rem 0;  
        }  
          
        .exercise-actions {  
            display: flex;  
            gap: 0.5rem;  
            margin-top: 0.75rem;  
        }  
          
        .empty-state {  
            text-align: center;  
            padding: 2rem;  
            color: #6b7280;  
        }  
          
        .program-item {  
            background: #f9fafb;  
            border: 1px solid #e5e7eb;  
            border-radius: 0.5rem;  
            padding: 1rem;  
            margin-bottom: 0.75rem;  
        }  
          
        .program-item h3 {  
            font-size: 1rem;  
            margin-bottom: 0.5rem;  
            color: #1f2937;  
        }  
          
        .program-item p {  
            font-size: 0.875rem;  
            color: #6b7280;  
            margin-bottom: 0.5rem;  
        }  
          
        .program-exercise {  
            background: #f9fafb;  
            border: 1px solid #e5e7eb;  
            border-radius: 0.5rem;  
            padding: 1rem;  
            margin-bottom: 0.75rem;  
        }  
          
        .program-exercise h4 {  
            font-size: 1rem;  
            margin-bottom: 0.5rem;  
        }  
          
        .program-controls {  
            display: flex;  
            gap: 0.5rem;  
            margin-top: 0.75rem;  
        }  
          
        .hidden {  
            display: none !important;  
        }  
          
        .alert {  
            position: fixed;  
            top: 5rem;  
            left: 50%;  
            transform: translateX(-50%);  
            background: #1f2937;  
            color: white;  
            padding: 1rem 1.5rem;  
            border-radius: 0.5rem;  
            box-shadow: 0 10px 15px rgba(0,0,0,0.3);  
            z-index: 1000;  
            animation: slideDown 0.3s ease;  
        }  
          
        @keyframes slideDown {  
            from {  
                opacity: 0;  
                transform: translateX(-50%) translateY(-1rem);  
            }  
            to {  
                opacity: 1;  
                transform: translateX(-50%) translateY(0);  
            }  
        }  
          
        .modal {  
            display: none;  
            position: fixed;  
            top: 0;  
            left: 0;  
            right: 0;  
            bottom: 0;  
            background: rgba(0, 0, 0, 0.5);  
            z-index: 200;  
            overflow-y: auto;  
            padding: 1rem;  
        }  
          
        .modal.active {  
            display: flex;  
            align-items: flex-start;  
            justify-content: center;  
        }  
          
        .modal-content {  
            background: white;  
            border-radius: 0.5rem;  
            width: 100%;  
            max-width: 600px;  
            margin: 2rem auto;  
        }  
          
        .modal-header {  
            display: flex;  
            justify-content: space-between;  
            align-items: center;  
            padding: 1rem;  
            border-bottom: 1px solid #e5e7eb;  
        }  
          
        .modal-header h2 {  
            font-size: 1.25rem;  
            color: #1f2937;  
        }  
          
        .close-btn {  
            background: none;  
            border: none;  
            font-size: 1.5rem;  
            color: #6b7280;  
            cursor: pointer;  
            padding: 0;  
            width: 2rem;  
            height: 2rem;  
        }  
          
        .modal form {  
            padding: 1rem;  
        }  
          
        .form-group {  
            margin-bottom: 1rem;  
        }  
          
        .form-group label {  
            display: block;  
            font-weight: 600;  
            margin-bottom: 0.5rem;  
            color: #374151;  
        }  
          
        .photo-list {  
            border: 1px solid #e5e7eb;  
            border-radius: 0.375rem;  
            margin-top: 0.5rem;  
            max-height: 200px;  
            overflow-y: auto;  
        }  
          
        .photo-item {  
            display: flex;  
            justify-content: space-between;  
            align-items: center;  
            padding: 0.5rem;  
            border-bottom: 1px solid #e5e7eb;  
        }  
          
        .photo-item:last-child {  
            border-bottom: none;  
        }  
          
        .photo-item span {  
            flex: 1;  
            overflow: hidden;  
            text-overflow: ellipsis;  
            white-space: nowrap;  
            font-size: 0.875rem;  
        }  
          
        @media print {  
            .no-print {  
                display: none !important;  
            }  
              
            body {  
                background: white;  
            }  
              
            .document-content {  
                margin: 0 !important;  
                max-width: 100% !important;  
            }  
        }  
          
        .document-header {  
            display: flex;  
            justify-content: space-between;  
            align-items: center;  
            margin-bottom: 1rem;
            padding-bottom: 0;
        }  
          
        .document-header img {  
            width: 80px;  
            height: 80px;  
            object-fit: contain;
        }  

        .document-service-title {
            text-align: center;
            color: #2563eb;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #2563eb;
        }

        .document-service-title h2 {
            font-size: 1.125rem;
            margin-bottom: 0.25rem;
        }

        .document-service-title p {
            font-size: 0.875rem;
        }
          
        .document-header .service-info {  
            text-align: right;  
            color: #2563eb;  
        }  
          
        .document-header .service-info h2 {  
            font-size: 1rem;  
            margin-bottom: 0.25rem;  
        }  
          
        .document-header .service-info p {  
            font-size: 0.875rem;  
        }  
          
        .document-date {  
            text-align: right;  
            color: #6b7280;  
            margin-bottom: 1.5rem;  
        }  
          
        .document-intro {  
            margin-bottom: 2rem;  
            line-height: 1.8;  
        }  
          
        .document-signature {  
            margin-top: 2rem;  
            padding-top: 1rem;  
            border-top: 1px solid #e5e7eb;  
        }  
          
        .document-exercise {  
            margin-bottom: 2rem;  
            page-break-inside: avoid;  
        }  
          
        .document-exercise h3 {  
            color: #2563eb;  
            font-size: 1.125rem;  
            margin-bottom: 0.5rem;  
        }  
          
        .document-exercise p {  
            margin-bottom: 0.5rem;  
            line-height: 1.6;  
        }  
          
        .document-exercise .consignes {  
            background: #f3f4f6;  
            padding: 0.75rem;  
            border-radius: 0.375rem;  
            margin: 0.75rem 0;  
            font-style: italic;  
        }  
          
        .document-exercise img {  
            max-width: 100%;  
            height: auto;  
            margin: 0.5rem 0;  
            border-radius: 0.375rem;  
        }  
    </style>  
</head>  
<body>  
    <div id="app">  
        <header role="banner">  
            <div class="header-content">  
                <img src="https://i.postimg.cc/d0kK4FTd/POULP-mail.png" alt="Logo pOULP" class="header-logo-left">  
                <div class="header-text">  
                    <h1>G√©n√©rateur de Programmes de R√©√©ducation</h1>  
                    <p>Service de M√©decine Physique et R√©adaptation</p>  
                </div>  
                <img src="https://i.postimg.cc/MTR20ftk/Logo_MPR.jpg" alt="Logo MPR Percy" class="header-logo-right">
            </div>  
            <nav class="nav-buttons" aria-label="Navigation principale">  
                <button onclick="app.showView('search')" aria-label="Aller √† la recherche d'exercices">üîç Recherche</button>  
                <button onclick="app.showView('admin')" aria-label="Aller √† l'administration des exercices">‚öôÔ∏è Admin</button>  
            </nav>  
        </header>  
  
        <div id="alert-container" role="status" aria-live="polite" aria-atomic="true"></div>  
  
        <main role="main">  
            <!-- Vue Recherche -->  
            <div id="view-search" class="container">  
                <section class="section" aria-label="Introduction">  
                    <p style="font-size: 1rem; line-height: 1.6; color: #374151; margin-bottom: 1.5rem;">  
                        <strong>Bienvenue !</strong> Voici pOULP, le g√©n√©rateur de programme de r√©√©ducation. Choisissez des exercices adapt√©s √† votre patient √† l'aide du formulaire de recherche, commentez les exercices s√©lectionn√©s et g√©n√©rez un fichier PDF pr√™t √† envoyer par e-mail.  
                    </p>  
                </section>  
  
                <section class="section" aria-label="Filtres de recherche">  
                    <h2>Filtres de recherche</h2>  

                    <!-- Alerte si filtres invalides -->
                    <div id="filter-alert" role="alert" aria-live="assertive" class="filter-alert hidden">
                        ‚ö†Ô∏è Veuillez d'abord s√©lectionner au moins une zone du corps
                    </div>
                      
                    <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.75rem;">  
                        <strong>Recherchez parmi tous les exercices :</strong>  
                    </p>  
                      
                    <div class="filter-group">  
                        <h3 class="filter-title" id="titre-recherche">Recherche par mot-cl√©</h3>
                        <input   
                            type="search"   
                            id="search-input"   
                            placeholder="Titre, description..."  
                            oninput="app.filterExercises()"  
                            aria-labelledby="titre-recherche"
                        >  
                    </div>  
  
                    <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem; margin-top: 1rem;">  
                        <strong>Choisissez une ou plusieurs zones du corps :</strong>  
                    </p>  
  
                    <div class="filter-group">  
                        <h3 class="filter-title" id="titre-zones">Zones du corps <span class="required-badge">obligatoire*</span></h3>
                        <p class="filter-description" aria-hidden="true">(obligatoire si pas de recherche)</p>
                        <div class="checkbox-group" id="zones-filters" role="group" aria-labelledby="titre-zones"></div>  
                    </div>  
  
                    <div class="collapsible-section">  
                        <div class="collapsible-header" onclick="app.toggleSection('types')" aria-expanded="false" aria-controls="types-content">  
                            <h3 class="filter-title" id="titre-types" style="margin: 0; font-size: 1rem;">Types d'exercice <span class="optional-badge">facultatif</span></h3>
                            <span class="chevron" id="chevron-types">‚ñº</span>  
                        </div>  
                        <div class="collapsible-content" id="types-content">  
                            <div class="checkbox-group" id="types-filters" role="group" aria-labelledby="titre-types"></div>  
                        </div>  
                    </div>  
  
                    <div class="collapsible-section">  
                        <div class="collapsible-header" onclick="app.toggleSection('materiel')" aria-expanded="false" aria-controls="materiel-content">  
                            <h3 class="filter-title" id="titre-materiel" style="margin: 0; font-size: 1rem;">Mat√©riel <span class="optional-badge">facultatif</span></h3>
                            <span class="chevron" id="chevron-materiel">‚ñº</span>  
                        </div>  
                        <div class="collapsible-content" id="materiel-content">  
                            <div class="checkbox-group" id="materiel-filters" role="group" aria-labelledby="titre-materiel"></div>  
                        </div>  
                    </div>  
                </section>  
  
                <section class="section" aria-label="R√©sultats de recherche">  
                    <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.75rem;">  
                        <strong>Ajoutez des exercices au programme :</strong>  
                    </p>  
                    <h2>Exercices (<span id="results-count">0</span>)</h2>  
                    <div id="exercises-list" role="list"></div>  
                </section>  
  
                <!-- Section Programme d√©plac√©e ici -->  
                <section class="section" aria-label="Programme en cours" id="section-programme">  
                    <h2 id="titre-programme">Programme en cours (<span id="program-count">0</span>)</h2>  
                      
                    <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem;">  
                        <strong>Personnalisez, r√©organisez et commentez les exercices s√©lectionn√©s :</strong>  
                    </p>  
                      
                    <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 1rem; font-style: italic;">  
                        Les exercices ajout√©s restent dans le programme, m√™me si vous changez les filtres.  
                    </p>  
                      
                    <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem;">Informations patient</h3>  
                      
                    <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.75rem;">  
                        <strong>Personnalisez le document avec un commentaire g√©n√©ral pour votre patient :</strong>  
                    </p>  
                      
                    <div class="form-group">  
                        <label for="patient-name">Pr√©nom du patient (facultatif)</label>  
                        <input   
                            type="text"   
                            id="patient-name"   
                            placeholder="Pr√©nom du patient"   
                            aria-label="Pr√©nom du patient"  
                            onkeydown="if(event.key === 'Enter') event.preventDefault()"  
                        >  
                    </div>  
  
                    <div class="form-group">  
                        <label for="custom-message">Message personnalis√© g√©n√©ral (facultatif)</label>  
                        <textarea   
                            id="custom-message"   
                            rows="4"   
                            placeholder="Recommandations g√©n√©rales pour le patient..."  
                            aria-label="Message personnalis√© g√©n√©ral pour le patient"  
                        ></textarea>  
                    </div>  
  
                    <h3 style="font-size: 1rem; font-weight: 600; margin: 1.5rem 0 0.75rem 0;">Exercices du programme</h3>  
                      
                    <div id="selected-exercises" role="list" aria-labelledby="titre-programme"></div>  
                      
                    <h2 id="titre-generation" style="font-size: 1.125rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem;">  
                        G√©n√©ration du document PDF  
                    </h2>  
                    <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.75rem;">  
                        Obtenez le programme personnalis√© avec photos :  
                    </p>  
                      
                    <button   
                        class="btn-success"   
                        onclick="app.generateDocument()"   
                        style="margin-top: 0.5rem;"  
                        aria-label="G√©n√©rer le document PDF du programme"  
                    >  
                        üìÑ G√©n√©rer le document  
                    </button>  
                </section>  
            </div>  
  
            <!-- Vue Admin -->  
            <div id="view-admin" class="container hidden">  
                <section class="section">  
                    <h2>Administration des exercices</h2>  
                      
                    <button class="btn-primary" onclick="app.openExerciseModal()" style="margin-bottom: 1rem;">  
                        ‚ûï Ajouter un exercice  
                    </button>  
  
                    <div class="filter-group">  
                        <label for="admin-search">Rechercher un exercice</label>  
                        <input   
                            type="search"   
                            id="admin-search"   
                            placeholder="Titre, description..."  
                            oninput="app.updateAdminList()"  
                        >  
                    </div>  
  
                    <div id="admin-exercises-list"></div>  
                </section>  
            </div>  
  
            <!-- Vue Document g√©n√©r√© -->  
            <div id="view-document" class="hidden">  
                <div class="no-print" style="position: fixed; top: 0; left: 0; right: 0; background: #2563eb; color: white; padding: 1rem; z-index: 100;">  
                    <!-- MESSAGE INFORMATIF -->  
                    <div role="note" style="max-width: 1200px; margin: 0 auto 0.75rem; font-size: 0.875rem; background: rgba(255,255,255,0.15); padding: 0.75rem; border-radius: 0.375rem; line-height: 1.5;">  
                        üí° <strong>Pour envoyer par email :</strong> Utilisez "Imprimer / Partager", puis enregistrez le PDF et joignez-le en pi√®ce jointe (les images s'afficheront correctement).  
                    </div>  
                      
                    <!-- BOUTONS D'ACTION -->  
                    <div style="display: flex; gap: 0.5rem; max-width: 1200px; margin: 0 auto;">  
                        <button onclick="app.showView('search')" style="background: white; color: #2563eb; border: none; padding: 0.75rem 1rem; border-radius: 0.375rem; font-weight: 600;" aria-label="Retourner √† la recherche">  
                            ‚Üê Retour  
                        </button>  
                        <button onclick="window.print()" style="background: #059669; color: white; border: none; padding: 0.75rem 1rem; border-radius: 0.375rem; font-weight: 600; flex: 1;" aria-label="Imprimer ou partager le document">  
                            üñ®Ô∏è Imprimer / Partager  
                        </button>  
                    </div>  
                </div>  
                <div class="document-content" id="document-output" style="max-width: 800px; margin: 5rem auto 2rem;"></div>  
            </div>  
        </main>  
  
        <!-- Modal Exercice -->  
        <div id="exercise-modal" class="modal" role="dialog" aria-labelledby="modal-title" aria-modal="true">  
            <div class="modal-content">  
                <div class="modal-header">  
                    <h2 id="modal-title">Ajouter un exercice</h2>  
                    <button class="close-btn" onclick="app.closeExerciseModal()" aria-label="Fermer la fen√™tre">&times;</button>  
                </div>  
                <form id="exercise-form" onsubmit="app.saveExercise(event)">  
                    <fieldset style="border: none; padding: 0; margin: 0;">  
                        <legend class="sr-only">Informations de base</legend>  
                          
                        <div class="form-group">  
                            <label for="ex-titre">Titre de l'exercice *</label>  
                            <input type="text" id="ex-titre" required aria-required="true">  
                        </div>  
  
                        <div class="form-group">  
                            <label for="ex-description">Description d√©taill√©e *</label>  
                            <textarea id="ex-description" rows="3" required aria-required="true"></textarea>  
                        </div>  
                    </fieldset>  
  
                    <fieldset style="border: 1px solid #e5e7eb; padding: 1rem; margin: 1rem 0; border-radius: 0.5rem;">  
                        <legend style="font-weight: 600; padding: 0 0.5rem;">Classification de l'exercice</legend>  
                          
                        <div class="form-group">  
                            <label id="label-zones">Zones du corps concern√©es *</label>  
                            <div class="checkbox-group" id="modal-zones" role="group" aria-labelledby="label-zones" aria-required="true"></div>  
                        </div>  
  
                        <div class="form-group">  
                            <label id="label-types">Types d'exercice *</label>  
                            <div class="checkbox-group" id="modal-types" role="group" aria-labelledby="label-types" aria-required="true"></div>  
                            <div style="margin-top: 0.75rem; padding: 0.75rem; background: #f9fafb; border-radius: 0.375rem;">  
                                <label for="new-type-input" style="font-size: 0.875rem; margin-bottom: 0.5rem;">Ajouter un nouveau type :</label>  
                                <div style="display: flex; gap: 0.5rem;">  
                                    <input type="text" id="new-type-input" placeholder="Ex: Cardio" style="flex: 1;">  
                                    <button type="button" class="btn-secondary btn-small" onclick="app.addNewType()">Ajouter</button>  
                                </div>  
                            </div>  
                        </div>  
  
                        <div class="form-group">  
                            <label id="label-materiel">Mat√©riel n√©cessaire</label>  
                            <div class="checkbox-group" id="modal-materiel" role="group" aria-labelledby="label-materiel"></div>  
                            <div style="margin-top: 0.75rem; padding: 0.75rem; background: #f9fafb; border-radius: 0.375rem;">  
                                <label for="new-materiel-input" style="font-size: 0.875rem; margin-bottom: 0.5rem;">Ajouter du nouveau mat√©riel :</label>  
                                <div style="display: flex; gap: 0.5rem;">  
                                    <input type="text" id="new-materiel-input" placeholder="Ex: Rouleau de massage" style="flex: 1;">  
                                    <button type="button" class="btn-secondary btn-small" onclick="app.addNewMateriel()">Ajouter</button>  
                                </div>  
                            </div>  
                        </div>  
                    </fieldset>  
  
                    <fieldset style="border: 1px solid #e5e7eb; padding: 1rem; margin: 1rem 0; border-radius: 0.5rem;">  
                        <legend style="font-weight: 600; padding: 0 0.5rem;">Photos de l'exercice</legend>  
                          
                        <div class="form-group">  
                            <label for="photo-url">URL de la photo *</label>  
                            <div style="display: flex; gap: 0.5rem;">  
                                <input type="text" id="photo-url" placeholder="https://..." style="flex: 1;">  
                                <button type="button" class="btn-secondary btn-small" onclick="app.addPhoto()">Ajouter</button>  
                            </div>  
                        </div>  
  
                        <div class="photo-list" id="photos-list">  
                            <div style="padding: 1rem; text-align: center; color: #6b7280;">Aucune photo ajout√©e</div>  
                        </div>  
                    </fieldset>  
  
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">  
                        <button type="button" class="btn-secondary" onclick="app.closeExerciseModal()" style="flex: 1;">  
                            Annuler  
                        </button>  
                        <button type="submit" class="btn-primary" style="flex: 1;">  
                            Enregistrer  
                        </button>  
                    </div>  
                </form>  
            </div>  
        </div>  
    </div>  
  
    <script src="exercices.js"></script>  
    <script>  
        const app = {  
            exercises: [],  
            selectedExercises: [],  
            categories: {},  
            editingExercise: null,  
            currentPhotos: [],  
  
            init() {  
                this.exercises = [...exercicesData];  
                this.categories = {...categoriesData};  
                  
                this.renderFilters();  
                this.filterExercises();  
                this.updateAdminList();  
                this.showView('search');  
            },  
  
            renderFilters() {  
                // Zones  
                const zonesContainer = document.getElementById('zones-filters');  
                zonesContainer.innerHTML = this.categories.zones.map(zone => `  
                    <label class="checkbox-label">  
                        <input type="checkbox" value="${zone}" onchange="app.filterExercises()">  
                        <span>${zone}</span>  
                    </label>  
                `).join('');  
  
                // Types  
                const typesContainer = document.getElementById('types-filters');  
                typesContainer.innerHTML = this.categories.types.map(type => `  
                    <label class="checkbox-label">  
                        <input type="checkbox" value="${type}" onchange="app.filterExercises()">  
                        <span>${type}</span>  
                    </label>  
                `).join('');  
  
                // Mat√©riel  
                const materielContainer = document.getElementById('materiel-filters');  
                materielContainer.innerHTML = this.categories.materiel.map(mat => `  
                    <label class="checkbox-label">  
                        <input type="checkbox" value="${mat}" onchange="app.filterExercises()">  
                        <span>${mat}</span>  
                    </label>  
                `).join('');  
  
                // Modal zones  
                const modalZones = document.getElementById('modal-zones');  
                modalZones.innerHTML = this.categories.zones.map(zone => `  
                    <label class="checkbox-label">  
                        <input type="checkbox" value="${zone}">  
                        <span>${zone}</span>  
                    </label>  
                `).join('');  
  
                // Modal types  
                const modalTypes = document.getElementById('modal-types');  
                modalTypes.innerHTML = this.categories.types.map(type => `  
                    <label class="checkbox-label">  
                        <input type="checkbox" value="${type}">  
                        <span>${type}</span>  
                    </label>  
                `).join('');  
  
                // Modal mat√©riel  
                const modalMateriel = document.getElementById('modal-materiel');  
                modalMateriel.innerHTML = this.categories.materiel.map(mat => `  
                    <label class="checkbox-label">  
                        <input type="checkbox" value="${mat}">  
                        <span>${mat}</span>  
                    </label>  
                `).join('');  
            },  
  
            toggleSection(section) {  
                const content = document.getElementById(`${section}-content`);  
                const chevron = document.getElementById(`chevron-${section}`);  
                const header = chevron.parentElement;  
                  
                const isOpen = content.classList.contains('open');  
                content.classList.toggle('open');  
                chevron.classList.toggle('open');  
                header.setAttribute('aria-expanded', !isOpen);  
            },

            checkFiltersValidity() {
                const searchTerm = document.getElementById('search-input').value.trim();
                const hasZones = document.querySelectorAll('#zones-filters input:checked').length > 0;
                const hasTypes = document.querySelectorAll('#types-filters input:checked').length > 0;
                const hasMateriel = document.querySelectorAll('#materiel-filters input:checked').length > 0;
                
                const alert = document.getElementById('filter-alert');
                
                // Afficher alerte si Types ou Mat√©riel coch√©s SANS zone ET sans recherche
                if ((hasTypes || hasMateriel) && !hasZones && !searchTerm) {
                    alert.classList.remove('hidden');
                } else {
                    alert.classList.add('hidden');
                }
            },  
  
            filterExercises() {
                // V√©rifier validit√© des filtres pour afficher alerte si besoin
                this.checkFiltersValidity();
                
                const searchTerm = document.getElementById('search-input').value.toLowerCase().trim();  
                  
                const selectedZones = Array.from(document.querySelectorAll('#zones-filters input:checked')).map(cb => cb.value);  
                const selectedTypes = Array.from(document.querySelectorAll('#types-filters input:checked')).map(cb => cb.value);  
                const selectedMateriel = Array.from(document.querySelectorAll('#materiel-filters input:checked')).map(cb => cb.value);  
  
                // N'afficher aucun exercice si ni recherche textuelle ni zones s√©lectionn√©es  
                if (!searchTerm && selectedZones.length === 0) {  
                    this.renderExercisesList([]);  
                    return;  
                }  
  
                let results = this.exercises;  
  
                // Recherche textuelle  
                if (searchTerm) {  
                    results = results.filter(ex =>   
                        ex.titre.toLowerCase().includes(searchTerm) ||  
                        ex.description.toLowerCase().includes(searchTerm) ||  
                        ex.zones.some(z => z.toLowerCase().includes(searchTerm)) ||  
                        ex.types.some(t => t.toLowerCase().includes(searchTerm))  
                    );  
                }  
  
                // 1er tamis : ZONES (mode OU uniquement)  
                if (selectedZones.length > 0) {  
                    results = results.filter(ex => selectedZones.some(z => ex.zones.includes(z)));  
                }  
  
                // 2√®me tamis : TYPES (mode OU uniquement)  
                if (selectedTypes.length > 0) {  
                    results = results.filter(ex => selectedTypes.some(t => ex.types.includes(t)));  
                }  
  
                // 3√®me tamis : MAT√âRIEL (mode OU strict)  
                if (selectedMateriel.length > 0) {  
                    results = results.filter(ex => {  
                        // "Sans mat√©riel" = exercices avec materiel vide  
                        if (selectedMateriel.includes('Sans mat√©riel') && ex.materiel.length === 0) {  
                            return true;  
                        }  
                        // Autres mat√©riels  
                        return selectedMateriel.some(m => m !== 'Sans mat√©riel' && ex.materiel.includes(m));  
                    });  
                }  
  
                // Tri automatique : Zone puis Type  
                results.sort((a, b) => {  
                    const zoneA = a.zones[0] || '';  
                    const zoneB = b.zones[0] || '';  
                    if (zoneA !== zoneB) {  
                        return zoneA.localeCompare(zoneB, 'fr');  
                    }  
                    const typeA = a.types[0] || '';  
                    const typeB = b.types[0] || '';  
                    return typeA.localeCompare(typeB, 'fr');  
                });  
  
                this.renderExercisesList(results);  
            },  
  
            renderExercisesList(exercises) {  
                const container = document.getElementById('exercises-list');  
                const count = document.getElementById('results-count');  
                  
                count.textContent = exercises.length;  
                  
                // Annonce VoiceOver  
                const searchTerm = document.getElementById('search-input').value.trim();  
                const selectedZones = Array.from(document.querySelectorAll('#zones-filters input:checked'));  
                  
                if (searchTerm || selectedZones.length > 0) {  
                    this.showAlert(`${exercises.length} exercice${exercises.length > 1 ? 's' : ''} trouv√©${exercises.length > 1 ? 's' : ''}`);  
                }  
  
                if (exercises.length === 0) {  
                    if (!searchTerm && selectedZones.length === 0) {  
                        container.innerHTML = '<div class="empty-state">Utilisez la recherche par mot-cl√© ou s√©lectionnez au moins une zone du corps pour afficher des exercices.</div>';  
                    } else {  
                        container.innerHTML = '<div class="empty-state">Aucun exercice ne correspond √† vos crit√®res.</div>';  
                    }  
                    return;  
                }  
  
                container.innerHTML = exercises.map(ex => `  
                    <article class="exercise-card" role="listitem">  
                        <h3>${ex.titre}</h3>  
                        <p>${ex.description}</p>  
                        <div style="margin-bottom: 0.75rem;">  
                            ${ex.zones.map(z => `<span class="badge badge-blue">${z}</span>`).join('')}  
                            ${ex.types.map(t => `<span class="badge badge-green">${t}</span>`).join('')}  
                            ${ex.materiel.length > 0 ? ex.materiel.map(m => `<span class="badge badge-purple">${m}</span>`).join('') : ''}  
                        </div>  
                        <div class="exercise-actions">  
                            <button class="btn-primary btn-small" onclick="app.addToProgram(${ex.id})" aria-label="Ajouter ${ex.titre} au programme">  
                                ‚ûï Ajouter au programme  
                            </button>  
                        </div>  
                    </article>  
                `).join('');  
            },  
  
            addToProgram(exerciseId) {  
                const exercise = this.exercises.find(ex => ex.id === exerciseId);  
                if (!exercise) return;  
  
                // V√©rifier si d√©j√† ajout√©  
                if (this.selectedExercises.some(ex => ex.id === exerciseId)) {  
                    this.showAlert('Cet exercice est d√©j√† dans le programme');  
                    return;  
                }  
  
                this.selectedExercises.push({  
                    ...exercise,  
                    consigne: ''  
                });  
  
                this.updateProgramCount();  
                this.renderSelectedExercises();  
                  
                // Annonce avec le nombre total d'exercices  
                const count = this.selectedExercises.length;  
                this.showAlert(`Exercice ajout√©. ${count} exercice${count > 1 ? 's' : ''} dans le programme`);  
            },  
  
            removeFromProgram(exerciseId) {  
                this.selectedExercises = this.selectedExercises.filter(ex => ex.id !== exerciseId);  
                this.updateProgramCount();  
                this.renderSelectedExercises();  
                this.showAlert('Exercice retir√© du programme');  
            },  
  
            moveUp(index) {  
                if (index === 0) return;  
                const exerciseName = this.selectedExercises[index].titre;  
                [this.selectedExercises[index - 1], this.selectedExercises[index]] =   
                [this.selectedExercises[index], this.selectedExercises[index - 1]];  
                this.renderSelectedExercises();  
                this.showAlert(`${exerciseName} d√©plac√© vers le haut`);  
            },  
  
            moveDown(index) {  
                if (index === this.selectedExercises.length - 1) return;  
                const exerciseName = this.selectedExercises[index].titre;  
                [this.selectedExercises[index], this.selectedExercises[index + 1]] =   
                [this.selectedExercises[index + 1], this.selectedExercises[index]];  
                this.renderSelectedExercises();  
                this.showAlert(`${exerciseName} d√©plac√© vers le bas`);  
            },  
  
            updateProgramCount() {  
                document.getElementById('program-count').textContent = this.selectedExercises.length;  
            },  
  
            renderSelectedExercises() {  
                const container = document.getElementById('selected-exercises');  
                this.updateProgramCount();  
  
                if (this.selectedExercises.length === 0) {  
                    container.innerHTML = '<div class="empty-state">Aucun exercice s√©lectionn√©. Ajoutez des exercices depuis la liste ci-dessus.</div>';  
                    return;  
                }  
  
                container.innerHTML = this.selectedExercises.map((ex, i) => `  
                    <article class="program-exercise" role="listitem" aria-labelledby="exercise-title-${ex.id}">  
                        <h4 id="exercise-title-${ex.id}">Exercice ${i + 1} : ${ex.titre}</h4>  
                        <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.75rem;">${ex.description}</p>  
                          
                        <div style="font-weight: 600; font-size: 0.875rem; margin-bottom: 0.5rem;">Actions :</div>  
                        <div class="program-controls" role="group" aria-label="Actions pour ${ex.titre}">  
                            <button class="btn-secondary btn-small" onclick="app.moveUp(${i})" ${i === 0 ? 'disabled' : ''} aria-label="D√©placer ${ex.titre} vers le haut dans la liste">‚Üë Haut</button>  
                            <button class="btn-secondary btn-small" onclick="app.moveDown(${i})" ${i === this.selectedExercises.length - 1 ? 'disabled' : ''} aria-label="D√©placer ${ex.titre} vers le bas dans la liste">‚Üì Bas</button>  
                            <button class="btn-danger btn-small" onclick="app.removeFromProgram(${ex.id})" aria-label="Retirer ${ex.titre} du programme">üóëÔ∏è Retirer</button>  
                        </div>  
                          
                        <label for="consigne-${ex.id}" style="display: block; margin-top: 1rem; font-size: 0.875rem; font-weight: 600;">  
                            Consignes sp√©cifiques pour cet exercice (facultatif) :  
                        </label>  
                        <input   
                            type="text"   
                            id="consigne-${ex.id}"  
                            value="${ex.consigne || ''}"  
                            placeholder="Ex: 3 s√©ries de 10 r√©p√©titions, 2 fois par jour"  
                            oninput="app.updateConsigne(${ex.id}, this.value)"  
                            onkeydown="if(event.key === 'Enter') event.preventDefault()"  
                            style="margin-top: 0.5rem;"  
                            aria-label="Consignes personnalis√©es pour l'exercice ${ex.titre}"  
                        >  
                        <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid #e5e7eb;">  
                    </article>  
                `).join('');  
            },  
  
            // Alias pour compatibilit√©  
            updateProgramView() {  
                this.renderSelectedExercises();  
            },  
  
            updateConsigne(exerciseId, value) {  
                const ex = this.selectedExercises.find(e => e.id === exerciseId);  
                if (ex) {  
                    ex.consigne = value;  
                }  
            },  
  
            generateDocument() {  
                if (this.selectedExercises.length === 0) {  
                    this.showAlert('Veuillez s√©lectionner au moins un exercice');  
                    return;  
                }  
  
                const patientName = document.getElementById('patient-name').value.trim();  
                const customMessage = document.getElementById('custom-message').value.trim();  
  
                const date = new Date().toLocaleDateString('fr-FR', {  
                    weekday: 'long',  
                    year: 'numeric',  
                    month: 'long',  
                    day: 'numeric'  
                });  
  
                const greeting = patientName ? `${patientName},` : 'Madame, Monsieur,';  
  
                let html = `  
                    <div class="document-header">  
                        <img src="https://i.postimg.cc/2jHfghbR/Logo_SSA.png" alt="Logo Service de Sant√© des Arm√©es">  
                        <img src="https://i.postimg.cc/MTR20ftk/Logo_MPR.jpg" alt="Logo Service MPR">
                    </div>

                    <div class="document-service-title">
                        <h2>Service de M√©decine Physique et R√©adaptation</h2>
                        <p>HNIA Percy</p>
                    </div>
  
                    <div class="document-date">${date}</div>  
  
                    <div class="document-intro">  
                        <p>${greeting}</p>  
                        <p>Vous avez r√©cemment b√©n√©fici√© de soins en masso-kin√©sith√©rapie dans notre service de m√©decine physique et r√©adaptation. Afin de poursuivre vos efforts, voici un programme d'exercices personnalis√©.</p>  
                        ${customMessage ? `<p>${customMessage}</p>` : ''}  
                    </div>  
  
                    <div class="document-signature">  
                        <p><strong>Bonne r√©√©ducation !</strong></p>  
                        <p>C√©cile HENRIET</p>  
                        <p>01 41 46 66 46</p>  
                        <p>fiches.kine.mpr.percy@gmail.com</p>  
                    </div>  
  
                    <h2 style="color: #2563eb; margin-bottom: 1.5rem;">VOS EXERCICES</h2>  
                `;  
  
                this.selectedExercises.forEach((ex, i) => {  
                    html += `  
                        <div class="document-exercise">  
                            <h3>${i + 1}. ${ex.titre}</h3>  
                            <p><strong>Description :</strong> ${ex.description}</p>  
                            ${ex.consigne ? `<div class="consignes"><strong>Consignes :</strong> ${ex.consigne}</div>` : ''}  
                            ${ex.photos.map(photo => `<img src="${photo.url}" alt="${photo.alt}">`).join('')}  
                        </div>  
                    `;  
                });  
  
                html += ``;  
  
                document.getElementById('document-output').innerHTML = html;  
                this.showView('document');  
                this.showAlert('Document g√©n√©r√© avec succ√®s');  
            },  
  
            showView(view) {  
                document.getElementById('view-search').classList.add('hidden');  
                document.getElementById('view-admin').classList.add('hidden');  
                document.getElementById('view-document').classList.add('hidden');  
  
                if (view === 'search') {  
                    document.getElementById('view-search').classList.remove('hidden');  
                } else if (view === 'admin') {  
                    document.getElementById('view-admin').classList.remove('hidden');  
                } else if (view === 'document') {  
                    document.getElementById('view-document').classList.remove('hidden');  
                }  
            },  
  
            addNewType() {  
                const input = document.getElementById('new-type-input');  
                const newType = input.value.trim();  
                  
                if (!newType) {  
                    this.showAlert('Veuillez entrer un type');  
                    return;  
                }  
  
                if (this.categories.types.includes(newType)) {  
                    this.showAlert('Ce type existe d√©j√†');  
                    return;  
                }  
  
                this.categories.types.push(newType);  
                this.categories.types.sort();  
                this.renderFilters();  
                input.value = '';  
                this.showAlert(`Type "${newType}" ajout√©`);  
            },  
  
            addNewMateriel() {  
                const input = document.getElementById('new-materiel-input');  
                const newMateriel = input.value.trim();  
                  
                if (!newMateriel) {  
                    this.showAlert('Veuillez entrer du mat√©riel');  
                    return;  
                }  
  
                if (this.categories.materiel.includes(newMateriel)) {  
                    this.showAlert('Ce mat√©riel existe d√©j√†');  
                    return;  
                }  
  
                this.categories.materiel.push(newMateriel);  
                this.categories.materiel.sort();  
                this.renderFilters();  
                input.value = '';  
                this.showAlert(`Mat√©riel "${newMateriel}" ajout√©`);  
            },  
  
            updateAdminList() {  
                const container = document.getElementById('admin-exercises-list');  
                const searchTerm = document.getElementById('admin-search').value.toLowerCase();  
                  
                let filtered = this.exercises;  
                if (searchTerm) {  
                    filtered = filtered.filter(ex =>   
                        ex.titre.toLowerCase().includes(searchTerm) ||  
                        ex.description.toLowerCase().includes(searchTerm)  
                    );  
                }  
                  
                if (filtered.length === 0) {  
                    container.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 2rem;">Aucun exercice trouv√©.</p>';  
                    return;  
                }  
  
                container.innerHTML = filtered.map(ex => `  
                    <article class="exercise-card" aria-labelledby="admin-ex-${ex.id}">  
                        <h3 id="admin-ex-${ex.id}">${ex.titre}</h3>  
                        <p>${ex.description}</p>  
                        <div style="margin-bottom: 0.75rem;">  
                            ${ex.zones.map(z => `<span class="badge badge-blue">${z}</span>`).join('')}  
                            ${ex.types.map(t => `<span class="badge badge-green">${t}</span>`).join('')}  
                        </div>  
                        <div class="exercise-actions" role="group" aria-label="Actions pour ${ex.titre}">  
                            <button class="btn-primary btn-small" onclick="app.editExercise(${ex.id})" aria-label="Modifier l'exercice ${ex.titre}">  
                                ‚úèÔ∏è Modifier  
                            </button>  
                            <button class="btn-danger btn-small" onclick="app.deleteExercise(${ex.id})" aria-label="Supprimer l'exercice ${ex.titre}">  
                                üóëÔ∏è Supprimer  
                            </button>  
                        </div>  
                    </article>  
                `).join('');  
            },  
  
            openExerciseModal(exerciseId = null) {  
                this.editingExercise = exerciseId;  
                this.currentPhotos = [];  
  
                const modal = document.getElementById('exercise-modal');  
                const title = document.getElementById('modal-title');  
                const form = document.getElementById('exercise-form');  
  
                form.reset();  
                  
                // Vider les champs d'ajout de type et mat√©riel  
                document.getElementById('new-type-input').value = '';  
                document.getElementById('new-materiel-input').value = '';  
                  
                if (exerciseId) {  
                    const ex = this.exercises.find(e => e.id === exerciseId);  
                    if (ex) {  
                        title.textContent = 'Modifier un exercice';  
                        document.getElementById('ex-titre').value = ex.titre;  
                        document.getElementById('ex-description').value = ex.description;  
                          
                        // Cocher les zones  
                        document.querySelectorAll('#modal-zones input').forEach(cb => {  
                            cb.checked = ex.zones.includes(cb.value);  
                        });  
                          
                        // Cocher les types  
                        document.querySelectorAll('#modal-types input').forEach(cb => {  
                            cb.checked = ex.types.includes(cb.value);  
                        });  
                          
                        // Cocher le mat√©riel  
                        document.querySelectorAll('#modal-materiel input').forEach(cb => {  
                            cb.checked = ex.materiel.includes(cb.value);  
                        });  
  
                        this.currentPhotos = [...ex.photos];  
                        this.renderPhotosList();  
                    }  
                } else {  
                    title.textContent = 'Ajouter un exercice';  
                }  
  
                modal.classList.add('active');  
            },  
  
            closeExerciseModal() {  
                document.getElementById('exercise-modal').classList.remove('active');  
                this.editingExercise = null;  
                this.currentPhotos = [];  
            },  
  
            addPhoto() {  
                const url = document.getElementById('photo-url').value.trim();  
                if (!url) {  
                    this.showAlert('Veuillez entrer une URL');  
                    return;  
                }  
  
                this.currentPhotos.push({  
                    url: url,  
                    alt: `Photo ${this.currentPhotos.length + 1}`  
                });  
  
                document.getElementById('photo-url').value = '';  
                this.renderPhotosList();  
            },  
  
            removePhoto(index) {  
                this.currentPhotos.splice(index, 1);  
                this.renderPhotosList();  
            },  
  
            renderPhotosList() {  
                const container = document.getElementById('photos-list');  
                  
                if (this.currentPhotos.length === 0) {  
                    container.innerHTML = '<div style="padding: 1rem; text-align: center; color: #6b7280;">Aucune photo ajout√©e</div>';  
                    return;  
                }  
  
                container.innerHTML = this.currentPhotos.map((photo, i) => `  
                    <div class="photo-item">  
                        <span title="${photo.url}">${photo.url.substring(0, 40)}${photo.url.length > 40 ? '...' : ''}</span>  
                        <button type="button" class="btn-danger btn-small" onclick="app.removePhoto(${i})" aria-label="Supprimer cette photo">√ó</button>  
                    </div>  
                `).join('');  
            },  
  
            saveExercise(event) {  
                event.preventDefault();  
  
                const titre = document.getElementById('ex-titre').value.trim();  
                const description = document.getElementById('ex-description').value.trim();  
  
                const zones = Array.from(document.querySelectorAll('#modal-zones input:checked')).map(cb => cb.value);  
                const types = Array.from(document.querySelectorAll('#modal-types input:checked')).map(cb => cb.value);  
                const materiel = Array.from(document.querySelectorAll('#modal-materiel input:checked')).map(cb => cb.value);  
  
                if (zones.length === 0) {  
                    this.showAlert('Veuillez s√©lectionner au moins une zone');  
                    return;  
                }  
  
                if (types.length === 0) {  
                    this.showAlert('Veuillez s√©lectionner au moins un type');  
                    return;  
                }  
  
                if (this.currentPhotos.length === 0) {  
                    this.showAlert('Veuillez ajouter au moins une photo');  
                    return;  
                }  
  
                const exerciseData = {  
                    titre,  
                    description,  
                    zones,  
                    types,  
                    materiel,  
                    photos: this.currentPhotos  
                };  
  
                if (this.editingExercise) {  
                    // Modification : garder la position dans la liste  
                    const index = this.exercises.findIndex(ex => ex.id === this.editingExercise);  
                    if (index !== -1) {  
                        this.exercises[index] = { ...exerciseData, id: this.editingExercise };  
                    }  
                    this.showAlert('Exercice modifi√© avec succ√®s');  
                } else {  
                    // Ajout : ajouter √† la fin  
                    const newId = Math.max(...this.exercises.map(ex => ex.id), 0) + 1;  
                    this.exercises.push({ ...exerciseData, id: newId });  
                    this.showAlert('Exercice ajout√© avec succ√®s');  
                }  
  
                this.closeExerciseModal();  
                this.filterExercises();  
                this.updateAdminList();  
            },  
  
            editExercise(exerciseId) {  
                this.openExerciseModal(exerciseId);  
            },  
  
            deleteExercise(exerciseId) {  
                const ex = this.exercises.find(e => e.id === exerciseId);  
                if (!ex) return;  
  
                if (confirm(`√ätes-vous s√ªr de vouloir supprimer "${ex.titre}" ?`)) {  
                    this.exercises = this.exercises.filter(e => e.id !== exerciseId);  
                    this.selectedExercises = this.selectedExercises.filter(e => e.id !== exerciseId);  
                    this.updateAdminList();  
                    this.filterExercises();  
                    this.updateProgramCount();  
                    this.showAlert('Exercice supprim√©');  
                }  
            },  
  
            showAlert(message) {  
                const container = document.getElementById('alert-container');  
                const alert = document.createElement('div');  
                alert.className = 'alert';  
                alert.textContent = message;  
                  
                container.appendChild(alert);  
  
                setTimeout(() => {  
                    alert.remove();  
                }, 3000);  
            },  
  
            handleKeyboardShortcuts(event) {  
                // Cmd (Mac) ou Ctrl (Windows/Linux)  
                const isCmdOrCtrl = event.metaKey || event.ctrlKey;  
                  
                if (!isCmdOrCtrl) return;  
  
                // Cmd/Ctrl + F : Recherche  
                if (event.key === 'f' || event.key === 'F') {  
                    event.preventDefault();  
                    this.showView('search');  
                    // Focus sur la barre de recherche  
                    setTimeout(() => {  
                        document.getElementById('search-input').focus();  
                    }, 100);  
                    this.showAlert('Vue Recherche activ√©e');  
                }  
  
                // Cmd/Ctrl + A : Administration  
                if (event.key === 'a' || event.key === 'A') {  
                    event.preventDefault();  
                    this.showView('admin');  
                    this.showAlert('Vue Administration activ√©e');  
                }  
  
                // √âchap : Fermer les modals  
                if (event.key === 'Escape') {  
                    const modal = document.getElementById('exercise-modal');  
                    if (modal.classList.contains('active')) {  
                        this.closeExerciseModal();  
                    }  
                }  
            }  
        };  
  
        // Initialiser l'app au chargement  
        document.addEventListener('DOMContentLoaded', () => {  
            app.init();  
              
            // Ajouter les raccourcis clavier  
            document.addEventListener('keydown', (e) => app.handleKeyboardShortcuts(e));  
        });  
    </script>  
</body>  
</html>
